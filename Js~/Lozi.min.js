var Lozi={Utils:{eulerAngles:function(a,b,c,d){return a?(b=b?b:Lozi.Math.degrees(a.rotation.x),c=c?c:Lozi.Math.degrees(a.rotation.y),d=d?d:Lozi.Math.degrees(a.rotation.z),a.rotation.set(Lozi.Math.radians(b),Lozi.Math.radians(c),Lozi.Math.radians(d)),{x:Lozi.Math.degrees(a.rotation.x),y:Lozi.Math.degrees(a.rotation.y),z:Lozi.Math.degrees(a.rotation.z)}):{x:0,y:0,z:0}},getMousePosition:function(a,b){var c=a.clientX+document.body.scrollLeft+b.scrollLeft-b.offsetLeft,d=a.clientY+document.body.scrollTop+b.scrollTop-b.offsetTop;return{x:c/b.clientWidth*2-1,y:2*-(d/b.clientHeight)+1}},getObjectByProperty:function(a,b,c){if(a&&a.length>0)for(var d=0;d<a.length;d++)if(a[d][b]&&a[d][b]==c)return a[d];return null},clearArray:function(a,b,c,d){if(a)for(;a.length>0;)c>0&&this.clearObject(a[a.length-1],b,c-1,d),a[a.length-1]=null,a.pop()},clearObject:function(a,b,c,d){if(a){b&&b(a);for(var e in a){c>0&&(e&&null!=e&&a[e]&&null!=a[e]&&a[e].constructor===Object&&this.clearObject(a[e],b,c-1),e&&null!=e&&a[e]&&null!=a[e]&&a[e].constructor===Array&&this.clearArray(a[e],b,c-1));var f=!0;if(d&&d.length>0)for(var g=0;g<d.length;g++)d[g]==e&&(f=!1);1==f&&(a[e]=null)}}},getPropertyArray:function(a,b,c){var d=[];if(a&&a.length>0)for(var e=0;e<a.length;e++)a[e][b]&&(d.push(a[e][b]),1==c&&(a[e][b]=null));return d}},Libraries:{Three:{Geometry:{generateGeometry:function(a,b,c,d,e){for(var f={name:"",vertices:[],normals:[],uvs:[]},g=0;g<e.length;g++)for(var h=0;h<e[g].length;h++){var i=parseInt(e[g][h]),j=3*(i>=0?i-1:i+b.length/3),k=3*(i>=0?i-1:i+c.length/3);f.vertices.push(b[j],b[j+1],b[j+2]),f.normals.push(c[k],c[k+1],c[k+2])}for(var g=0;g<d.length;g++){f.uvs.push([]);for(var h=0;h<e.length;h++)for(var l=0;l<e[h].length;l++){var i=parseInt(e[h][l]),m=2*(i>=0?i-1:i+d[g].length/2);f.uvs[g].push(d[g][m],d[g][m+1])}}return f.name=a,f},generateSkinData:function(a,b){for(var c=4,d=[],e=[],f=0;f<b.geometry.faces.length;f++)for(var g=0;g<b.geometry.faces[f].length;g++){var h=parseInt(b.geometry.faces[f][g]),i=4*(h>=0?h-1:h+b.skin.skinWeights.length/4),j=4*(h>=0?h-1:h+e.length/4);d.push(b.skin.skinWeights[i],b.skin.skinWeights[i+1],b.skin.skinWeights[i+2],b.skin.skinWeights[i+3]),e.push(b.skin.skinIndices[j],b.skin.skinIndices[j+1],b.skin.skinIndices[j+2],b.skin.skinIndices[j+3])}if(d&&d.length>0)for(var k=0,l=d.length;k<l;k+=c){var m=d[k],n=void 0!==d[k+1]?d[k+1]:0,o=void 0!==d[k+2]?d[k+2]:0,p=void 0!==d[k+3]?d[k+3]:0;a.skinWeights.push(new THREE.Vector4(m,n,o,p))}if(e&&e.length>0)for(var k=0,l=e.length;k<l;k+=c){var q=e[k],r=c>1?e[k+1]:0,s=c>2?e[k+2]:0,t=c>3?e[k+3]:0;a.skinIndices.push(new THREE.Vector4(q,r,s,t))}return a.bones=b.skin.bones,a},generateBlendShapeData:function(a,b){for(var c=b.morph.blendShapes,d=0;d<c.length;d++){a.morphTargets[d]={},a.morphTargets[d].name=c[d].name,a.morphTargets[d].vertices=[];for(var e=c[d],f=this.generateGeometry(e.name,e.vertices,b.geometry.normals,b.geometry.uv,b.geometry.faces),g=0;g<f.vertices.length;g+=3){var h=new THREE.Vector3(f.vertices[g],f.vertices[g+1],f.vertices[g+2]);a.morphTargets[d].vertices.push(h)}}return a},generateMeshGeometry:function(a){var b;if(a.geometry){var c=this.generateGeometry(a.name,a.geometry.vertices,a.geometry.normals,a.geometry.uv,a.geometry.faces);if(b=new THREE.BufferGeometry,b.addAttribute("position",new THREE.BufferAttribute(new Float32Array(c.vertices),3)),c.normals.length>0&&b.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(c.normals),3)),c.uvs.length>0)for(var d=0;d<c.uvs.length;d++){var e=d>0?d+1:"";b.addAttribute("uv"+e,new THREE.BufferAttribute(new Float32Array(c.uvs[d]),2))}for(var f=0,d=0;d<a.geometry.faces.length;d++)b.addGroup(f,a.geometry.faces[d].length,d),f+=a.geometry.faces[d].length}return b.hasSkin=!1,b.hasMorph=!1,(a.skin||a.morph)&&(b=(new THREE.Geometry).fromBufferGeometry(b),a.skin&&(b.hasSkin=!0,b=this.generateSkinData(b,a)),a.morph&&(b.hasMorph=!0,b=this.generateBlendShapeData(b,a))),a.id&&(b.meshID=a.id),a.geometry.castShadows&&(b.castShadow=a.geometry.castShadows),a.geometry.recieveShadows&&(b.receiveShadow=a.geometry.recieveShadows),b},createMeshByGeometryID:function(a,b,c){var d,e,f=[],g=Lozi.Utils.getObjectByProperty(c.geometries,"meshID",a);if(b){for(var h=0;h<b.length;h++){var i=Lozi.Utils.getObjectByProperty(c.materials,"matId",b[h]);i&&f.push(i)}e=f.length>1?new THREE.MultiMaterial(f):f[0]}if(g&&e&&f&&f.length>0){if(0==g.hasMorph&&0==g.hasSkin)d=new THREE.Mesh(g,e);else{d=new THREE.SkinnedMesh(g,e);for(var h=0;h<f.length;h++)f[h].skinning=g.hasSkin,f[h].morphTargets=g.hasMorph}g.recieveShadows&&(d.receiveShadow=g.receiveShadow),g.castShadows&&(d.castShadow=g.castShadow)}return d},disposeMesh:function(a){a.parent&&a.parent.remove(a)},disposeGeometry:function(a){a.dispose&&a.constructor===Function&&a.dispose(),a.removeAttribute&&(a.removeAttribute("position"),a.removeAttribute("normal"),a.removeAttribute("uv"),a.removeAttribute("uv2"))}},Material:{generateMaterial:function(a,b){var c;switch(a.type){case 0:c=new THREE.MeshStandardMaterial;break;case 1:c=new THREE.MeshBasicMaterial;break;case 2:c=new THREE.MeshPhongMaterial;break;case 3:c=new THREE.MeshLambertMaterial}if(c)return c.matId=a.id,c.name=a.name,c.materialSide=a.side,c.side=0==c.materialSide?THREE.FrontSide:1==c.materialSide?THREE.BackSide:2==c.materialSide?THREE.DoubleSide:THREE.FrontSide,a.properties&&(1!=a.type&&(a.properties._EmissionMap&&(c.emissiveMap=Lozi.Utils.getObjectByProperty(b.generatedAssets.textures,"texID",a.properties._EmissionMap)),a.properties._EmissionColor&&(c.emissive=new THREE.Color(a.properties._EmissionColor[0],a.properties._EmissionColor[1],a.properties._EmissionColor[2])),a.properties._BumpMap&&3!=a.type&&(c.bumpMap=Lozi.Utils.getObjectByProperty(b.generatedAssets.textures,"texID",a.properties._BumpMap),c.bumpMapScale=1),a.properties._Illum&&(c.emissiveMap=Lozi.Utils.getObjectByProperty(b.generatedAssets.textures,"texID",a.properties._Illum),c.emissive=new THREE.Color(1,1,1))),a.properties._Cube&&(c.envMap=Lozi.Utils.getObjectByProperty(b.generatedAssets.textures,"texID",a.properties._Cube),c.metalness=1),a.properties._ReflectColor&&(c.envMapIntensity=a.properties._ReflectColor[3]),a.properties._Color&&(c.color=new THREE.Color(a.properties._Color[0],a.properties._Color[1],a.properties._Color[2])),a.properties._Metallic&&(c.metalness=a.properties._Metallic),a.properties._MainTex&&(c.map=Lozi.Utils.getObjectByProperty(b.generatedAssets.textures,"texID",a.properties._MainTex)),a.properties.transparentMap&&(c.transparent=!0,c.alphaMap=Lozi.Utils.getObjectByProperty(b.generatedAssets.textures,"texID",a.properties.transparentMap)),a.properties.specularMap&&(c.specular=Lozi.Utils.getObjectByProperty(b.generatedAssets.textures,"texID",a.properties.specularMap)),a.properties._BumpScale&&(c.bumpMapScale=a.properties._BumpScale),a.properties.lightMap&&(c.lightMap=Lozi.Utils.getObjectByProperty(b.generatedAssets.textures,"texID",a.properties.lightMap))),c},disposeMaterial:function(a){a.dispose&&a.constructor===Function&&a.dispose()}},Texture:{generateTexture:function(a){if(a&&a.textureData&&a.textureData.length>0&&a.textureData[0]){var b=a.textureData[0],c=new THREE.Texture;return c.texID=a.id,c.name=a.name,c.image=b,c.usedImages=[c.image],c.needsUpdate=!0,c}},generateCubeTexture:function(a){if(a&&a.textureData&&a.textureData.length>0){var b=new THREE.CubeTexture;b.texID=a.id,b.name=a.name,b.images=[],b.usedImages=b.images,b.needsUpdate=!0;for(var c=0;c<a.textureData.length;c++)b.images.push(a.textureData[c]);return b}},disposeTexture:function(a){a.dispose&&a.constructor===Function&&a.dispose()},disposeImage:function(a){a.src&&(a.src="")}},Animation:{generateSkinAnimationClip:function(a,b){if(a&&b&&b&&b.length>0){if(a.hierarchy){for(var c=[],d=0;d<b.length;d++)c.push({});for(var e=0;e<a.hierarchy.length;e++){var f=a.hierarchy[e];if(f.keys)for(var g=0;g<f.keys.length;g++)f.keys[g]=f.keys[g];c[a.hierarchy[e].index]=f}}return a.hierarchy=c,THREE.AnimationClip.parseAnimation(a,b)}},setAnimation:function(a,b){var c=new THREE.AnimationMixer(a);if(b.clips&&b.clips.length>0){c.clips={};for(var d=0;d<b.clips.length;d++)b.clips[d]&&(c.clips[b.clips[d].name]=c.clipAction(b.clips[d],a),c.clips[b.clips[d].name].id=b.clips[d].id,c.clips[b.clips[d].name].name=b.clips[d].name,c.clips[b.clips[d].name].mode=b.clips[d].mode,c.clips[b.clips[d].name].duration=b.clips[d].duration,c.clips[b.clips[d].name].setEffectiveWeight(1))}return c},loopMode:function(a){return"Once"==a?THREE.LoopOnce:"PingPong"==a?THREE.LoopPingPong:THREE.LoopRepeat},disposeAnimation:function(a){if(a.stopAllAction&&a.stopAllAction(),a.uncacheRoot&&a.getRoot&&a.uncacheRoot(a.getRoot()),a.clips)for(var b in a.clips)a.clips[b].stop(),a.uncacheClip(a.clips[b].getClip()),a.uncacheAction(a.clips[b]),a.clips[b]=null}},Light:{setLightData:function(a,b){a.color=new THREE.Color(b.color[0],b.color[1],b.color[2]),a.intensity=b.intensity,a.distance=100*b.range,a.angle=Lozi.Math.radians(b.angle),a.castShadow=b.shadow,a.lightID=b.lightID}},Camera:{setCameraData:function(a,b){a.cameraID=b.cameraID,a.fov=-b.fov,a.near=b.near,a.far=b.far,a.left=b.orthoSize,a.right=b.orthoSize,a.top=b.orthoSize,a.bottom=b.orthoSize,a.updateProjectionMatrix()}},Sound:{createListener:function(a){var b=new THREE.AudioListener;return a&&a.add(b),b},createSource:function(a,b,c,d){var e=new THREE.PositionalAudio(a);return e.setBuffer(c.dataBuffer),e.setRefDistance(b.spread),e.source.loop=b.loop,e.sourceID=b.id,e.setVolume(1==b.mute?0:1),1==b.autoPlay&&e.play(),d.sound=e,d.add(d.sound),e},disposeSoundSource:function(a){1==a.isPlaying&&a.stop(),a.parent&&a.parent.remove(a)},disposeSoundListener:function(a){a.parent&&a.parent.remove(a)}},Object:{updateObjectRenderer:function(a){return a&&a.render&&(a.baseRender||(a.baseRender=a.render,a.raycaster=new THREE.Raycaster,a.render=function(a,b,c,d){this.currentCamera=b,this.baseRender(a,b,c,d)})),a},classByType:function(a){switch(a){case Lozi.Static.Object.types.Mesh:type=THREE.Mesh;break;case Lozi.Static.Object.types.SkinnedMesh:type=THREE.SkinnedMesh;break;case Lozi.Static.Object.types.OrthographicCamera:type=THREE.PerspectiveCamera;break;case Lozi.Static.Object.types.PerspectiveCamera:type=THREE.PerspectiveCamera;break;case Lozi.Static.Object.types.AreaLight:type=THREE.AmbientLight;break;case Lozi.Static.Object.types.PointLight:type=THREE.PointLight;break;case Lozi.Static.Object.types.DirectionalLight:type=THREE.DirectionalLight;break;case Lozi.Static.Object.types.SpotLight:type=THREE.SpotLight;break;case Lozi.Static.Object.types.Object:case Lozi.Static.Object.types.AnimationObject:case Lozi.Static.Object.types.Object3D:type=THREE.Object3D;break;case Lozi.Static.Object.types.Scene:type=THREE.Scene}return type.prototype.onAdded=type.prototype.traverse,type},onInteract:function(a,b,c,d){var e=Lozi.Utils.getMousePosition(a,c.domElement);if(c&&c.raycaster&&c.currentCamera){c.raycaster.setFromCamera(e,c.currentCamera);var f=c.raycaster.intersectObjects(b);f.length>0&&d&&d(f[0])}},disposeObject:function(a){a.parent&&a.parent.remove(a)}}},object:function(){if("undefined"!=typeof THREE)return Lozi.Libraries.Three;throw new Error("NO WEBGL LIBRARY INCLUDED!")}},Static:{Geometry:{generateMeshGeometry:function(a,b){return b&&a.skin&&a.skin.bones&&(a.skin.bones=this.getMeshBoneAssets(a.skin.bones,b)),Lozi.Libraries.object().Geometry.generateMeshGeometry(a)},parseGeometries:function(a,b){var c=[];if(a)for(var d=0;d<a.length;d++)a[d]&&c.push(this.generateMeshGeometry(a[d],b));return c},getMeshBoneAssets:function(a,b){for(var c=0;c<b.length;c++)if(b[c].id==a)return b[c].bones;return a},createMeshByGeometryID:function(a,b,c){return Lozi.Libraries.object().Geometry.createMeshByGeometryID(a,b,c)},disposeMesh:function(a){Lozi.Libraries.object().Geometry.disposeMesh(a)},disposeGeometry:function(a){Lozi.Libraries.object().Geometry.disposeGeometry(a)}},Material:{generateMaterial:function(a,b){return Lozi.Libraries.object().Material.generateMaterial(a,b)},generateMaterials:function(a,b){for(var c=[],d=0;d<a.length;d++){var e=this.generateMaterial(a[d],b);e&&c.push(e)}return c},disposeMaterial:function(a){Lozi.Libraries.object().Material.disposeMaterial(a)}},Texture:{loadImage:function(a,b,c,d){Image.prototype.loadImage=function(a,b,c,d){var e=this;if(e.onload=function(a){var c=a.path?a.path[0]:a.target;c.loaded=!0,b&&b()},a.indexOf("data:image/png;base64,")>-1)e.src=a,e.loadProgress=1,c&&c(e.loadProgress);else{var f=new XMLHttpRequest;f.onload=function(){var a=new Blob([this.response]);e.src=window.URL.createObjectURL(a)},f.onprogress=function(a){e.loadProgress=a.loaded/a.total,c&&c(e.loadProgress)},f.onerror=d,f.open("GET",a,!0),f.responseType="arraybuffer",f.send()}};var e=new Image;return e.loadImage(a,b,c,d),e},loadImages:function(a,b,c,d){for(var e=[],f=0;f<a.length;f++)for(var g=0;g<a[f].textureData.length;g++){var h=this.loadImage(a[f].textureData[g],b,c,d);a[f].textureData[g]=h,e.push(h)}return e},loadTexture:function(a){if(a&&a.textureData&&a.textureData.length>0){var b;switch(a.textureData.length){case 1:b=Lozi.Libraries.object().Texture.generateTexture(a);break;case 6:b=Lozi.Libraries.object().Texture.generateCubeTexture(a)}return b}},loadTextures:function(a){for(var b=[],c=0;c<a.length;c++){var d=this.loadTexture(a[c]);d&&b.push(d)}return b},getTextureImages:function(a,b){for(var c=[],d=0;d<a.length;d++)for(var e=0;e<a[d].usedImages.length;e++)a[d].usedImages[e].onload=function(a){var c=a.path?a.path[0]:a.target;c.loaded=!0,b&&b()},c.push(a[d].usedImages[e]);return c},disposeTexture:function(a){Lozi.Libraries.object().Texture.disposeTexture(a)}},Sound:{loadSound:function(a,b,c,d){var e={};e.id=a.id,e.name=a.name;var f=new XMLHttpRequest;return f.open("GET",a.data,!0),f.responseType="arraybuffer",f.onload=function(){window.AudioContext=window.AudioContext||window.webkitAudioContext;var a=new AudioContext;a.decodeAudioData(f.response,function(a){e.dataBuffer=a,e.loaded=!0,b&&b()},function(a){console.error("Couldn't decode audio!")})},f.onprogress=function(a){e.loadProgress=a.loaded/a.total,c&&c(e.loadProgress)},f.onerror=d,f.send(),e},loadSounds:function(a,b,c,d){for(var e=[],f=0;f<a.length;f++){var g=this.loadSound(a[f],b,c,d);e.push(g)}return e},createListener:function(a){return Lozi.Libraries.object().Sound.createListener(a)},setSounds:function(a){for(var b=0;b<a.soundSources().length;b++)this.setSound(a.soundSources()[b],a)},setSound:function(a,b){var c=a.sound,d=b.soundListeners().length>0?b.soundListeners()[0]:b.createSoundListener(),e=Lozi.Utils.getObjectByProperty(b.data().generatedAssets.sounds,"id",c.clip);e&&Lozi.Libraries.object().Sound.createSource(d,c,e,a)},disposeSoundSource:function(a){Lozi.Libraries.object().Sound.disposeSoundSource(a)},disposeSoundListener:function(a){Lozi.Libraries.object().Sound.disposeSoundListener(a)}},Animation:{setAnimationData:function(a,b){var c=[];if(b&&a){var d=Lozi.Utils.getObjectByProperty(b.generatedAssets.animations.skin,"id",a.animationID);if(d&&d.clips&&d.clips.length>0){var e=Lozi.Libraries.object().Animation.setAnimation(a,d);e.id=d.id,a.mixer=e,c.push(e)}}return c},generateSkinAnimations:function(a,b){var c=[];if(a&&a.length>0&&b.objects)for(var d=Lozi.Static.Object.getHierarchyObjectsByProperty(b.objects,"animationID"),e=0;e<d.length;e++)if(d[e].meshID){var f=Lozi.Utils.getObjectByProperty(b.assets.meshes,"id",d[e].meshID);if(f&&f.skin&&f.skin.bones)for(var g=0;g<a.length;g++)if(d[e].animationID==a[g].id&&!Lozi.Utils.getObjectByProperty(c,"id",a[g].id)){var h={};if(h.id=a[g].id,h.clips=[],c.push(h),a[g].clips)for(var i=0;i<a[g].clips.length;i++)if(!Lozi.Utils.getObjectByProperty(h.clips,"id",a[g].clips[i].id)){var j=this.generateSkinAnimationClip(a[g].clips[i],f.skin.bones);j.id=a[g].clips[i].id,j.mode=a[g].clips[i].mode,j.duration=a[g].clips[i].length,h.clips.push(j)}}}return c},generateSkinAnimationClip:function(a,b){return Lozi.Libraries.object().Animation.generateSkinAnimationClip(a,b)},getGeneratedClips:function(a){var b=[];if(a)for(var c=0;c<a.length;c++)if(a[c])for(var d in a[c].clips)b.push(a[c].clips[d]);return b},loopMode:function(a){return Lozi.Libraries.object().Animation.loopMode(a)},disposeAnimation:function(a){Lozi.Libraries.object().Animation.disposeAnimation(a)}},Light:{setLightData:function(a,b){Lozi.Libraries.object().Light.setLightData(a,b)}},Camera:{setCameraData:function(a,b){Lozi.Libraries.object().Camera.setCameraData(a,b)}},ScriptProperties:{getTypeFromEnum:function(a){var b=a;switch(a){case 0:b="Float";break;case 1:b="Int";break;case 2:b="Boolean";break;case 3:b="String";break;case 4:b="Rect";break;case 5:b="Vector2";break;case 6:b="Vector3";break;case 7:b="Vector4";break;case 8:b="Material";break;case 9:b="Texture2D";break;case 10:b="Cubemap";break;case 11:b="Mesh";break;case 12:b="AudioClip";break;case 13:b="AudioSource";break;case 14:b="Animation";break;case 15:b="AnimationClip";break;case 16:b="Light";break;case 17:b="Camera";break;case 18:b="Collider";break;case 19:b="Object";break;case 20:b="Float[]";break;case 21:b="Int[]";break;case 22:b="Boolean[]";break;case 23:b="String[]";break;case 24:b="Rect[]";break;case 25:b="Vector2[]";break;case 26:b="Vector3[]";break;case 27:b="Vector4[]";break;case 28:b="Material[]";break;case 29:b="Texture2D[]";break;case 30:b="Cubemap[]";break;case 31:b="Mesh[]";break;case 32:b="AudioClip[]";break;case 33:b="AudioSource[]";break;case 34:b="Animation[]";break;case 35:b="AnimationClip[]";break;case 36:b="Light[]";break;case 37:b="Camera[]";break;case 38:b="Collider[]";break;case 39:b="Object[]"}return b},parseEnumsToTypes:function(a){if(a)for(var b in a)for(var c in a[b])a[b][c].type=this.getTypeFromEnum(a[b][c].type);return a},bindPropertyToObject:function(a,b,c,d){if(a&&b&&c&&d&&b.type.indexOf(a)>-1)if(b.type.indexOf("[]")>-1){for(var e=[],f=0;f<b.value.length;f++){var g=Lozi.Utils.getObjectByProperty(c,d,b.value[f]);g=g?g:b.value[f],e.push(g)}b.value=e}else{var g=Lozi.Utils.getObjectByProperty(c,d,b.value);g&&(b.value=g)}return b},bindPropertiesToObjects:function(a,b){if(a&&b)for(var c in a)for(var d in a[c]){var e=a[c][d];e=this.bindPropertyToObject("Material",e,b.data().generatedAssets.materials,"matId"),e=this.bindPropertyToObject("Texture2D",e,b.data().generatedAssets.textures,"texID"),e=this.bindPropertyToObject("Cubemap",e,b.data().generatedAssets.textures,"texID"),e=this.bindPropertyToObject("AudioClip",e,b.data().generatedAssets.sounds,"id"),e=this.bindPropertyToObject("AnimationClip",e,Lozi.Static.Animation.getGeneratedClips(b.animations()),"id"),e=this.bindPropertyToObject("AudioSource",e,Lozi.Utils.getPropertyArray(b.soundSources(),"sound"),"sourceID"),e=this.bindPropertyToObject("Collider",e,b.colliders(),"id"),e=this.bindPropertyToObject("Mesh",e,b.meshes(),"meshGeometryID"),e=this.bindPropertyToObject("Animation",e,b.animations(),"id"),e=this.bindPropertyToObject("Object",e,b.objects(!0),"loziID"),e=this.bindPropertyToObject("Camera",e,b.cameras(),"cameraID"),e=this.bindPropertyToObject("Light",e,b.lights(),"lightID"),a[c][d]=e}return a},parseProperties:function(a,b){return a=this.parseEnumsToTypes(a),a=this.bindPropertiesToObjects(a,b)},parseObjectProperties:function(a){if(a&&a.properties().length>0)for(var b=0;b<a.properties().length;b++)a.properties()[b].properties=this.parseProperties(a.properties()[b].properties,a)}},Colliders:{},Object:{types:{None:0,Scene:1,Object3D:2,AnimationObject:3,Object:4,Bone:5,SpotLight:6,DirectionalLight:7,PointLight:8,AreaLight:9,PerspectiveCamera:10,OrthographicCamera:11,SkinnedMesh:12,Mesh:13},getHierarchyObjectsByProperty:function(a,b,c){if(c=c?c:[],a&&(a[b]&&c.indexOf(a)<0&&c.push(a),a.children))for(var d=0;d<a.children.length;d++)this.getHierarchyObjectsByProperty(a.children[d],b,c);return c},getHierarchyObjectByID:function(a,b){if(a){if(a.id==b)return a;if(a.children)for(var c=0;c<a.children.length;c++){var d=this.getHierarchyObjectByID(a.children[c],b);if(d)return d}}return null},generateLoziObject:function(a,b){if(a){var c=a.objects;if(b){var d=this.getHierarchyObjectByID(a.objects,b);d&&(c=d)}var e=this.objectByType(c),f=LoziObject;if(e){var g;(c.type==Lozi.Static.Object.types.Mesh||c.type==Lozi.Static.Object.types.SkinnedMesh||c.meshID)&&(g=this.generateObject(c,a.generatedAssets),e=this.classByType(Lozi.Static.Object.types.Object3D)),f=this.extend(e,LoziObject);var h=new f(a,c,e);return g&&h.add(g),Lozi.Static.Sound.setSounds(h),Lozi.Static.ScriptProperties.parseObjectProperties(h),h}}},generateObject:function(a,b){var c;if((a.type==Lozi.Static.Object.types.SkinnedMesh||a.type==Lozi.Static.Object.types.Mesh||a.meshID)&&(c=Lozi.Static.Geometry.createMeshByGeometryID(a.meshID,a.materials,b)),!c){var d=this.classByType(a.type);d&&a.type!=Lozi.Static.Object.types.SkinnedMesh&&a.type!=Lozi.Static.Object.types.Mesh&&(c=new d)}return c},classByType:function(a){return Lozi.Libraries.object().Object.classByType(a)},objectByType:function(a){var b;return a&&(b=Lozi.Static.Object.classByType(a.type)),b},extend:function(a,b){return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b},updateObjectRenderer:function(a){return Lozi.Libraries.object().Object.updateObjectRenderer(a)},onInteract:function(a,b,c,d){return Lozi.Libraries.object().Object.onInteract(a,b,c,d)},disposeObject:function(a){Lozi.Libraries.object().Object.disposeObject(a)}}},Math:{radians:function(a){return a*Math.PI/180},degrees:function(a){return 180*a/Math.PI}},disposeData:function(a){a&&(Lozi.Utils.clearArray(a.generatedAssets.animations.skin,null,100),Lozi.Utils.clearArray(a.generatedAssets.materials,Lozi.Static.Material.disposeMaterial,1),Lozi.Utils.clearArray(a.generatedAssets.textures,Lozi.Static.Texture.disposeTexture,1),Lozi.Utils.clearArray(a.generatedAssets.images,Lozi.Static.Texture.disposeImage,0),Lozi.Utils.clearArray(a.generatedAssets.geometries,Lozi.Static.Geometry.disposeGeometry,1e3),Lozi.Utils.clearArray(a.generatedAssets.sounds,null,1e3),Lozi.Utils.clearArray(a.assets.bones,null,1e3),Lozi.Utils.clearArray(a.assets.materials,null,1e3),Lozi.Utils.clearArray(a.assets.meshes,null,1e3),Lozi.Utils.clearArray(a.assets.sounds,null,1e3),Lozi.Utils.clearArray(a.assets.textures,null,2),Lozi.Utils.clearObject(a.assets.animations,null,1e3),Lozi.Utils.clearObject(a,null,1e3))},loadFromGeneratedData:function(a){return Lozi.Static.Object.generateLoziObject(a)},loadFromData:function(a,b,c,d,e){if(e=0!=e||e,a){var f=function(a,b,c,d){var e=function(){var c=!0;if(a.generatedAssets.images)for(var d=0;d<a.generatedAssets.images.length;d++)a.generatedAssets.images[d].loaded||(c=!1);if(a.generatedAssets.sounds)for(var d=0;d<a.generatedAssets.sounds.length;d++)a.generatedAssets.sounds[d].loaded||(c=!1);1==c&&b&&b()},f=function(){var b=0,d=0,e=0,f=0,g=0;if(a.generatedAssets.sounds){for(var h=0;h<a.generatedAssets.sounds.length;h++){var i=a.generatedAssets.sounds[h].loadProgress;b+=i?i:0}f=a.generatedAssets.sounds.length,b/=f}if(a.generatedAssets.images){for(var h=0;h<a.generatedAssets.images.length;h++){var i=a.generatedAssets.images[h].loadProgress;d+=i?i:0}g=a.generatedAssets.images.length,d/=g}e=(d+b)/2,f>0&&(e=b),g>0&&(e=d),g>0&&f>0&&(e=(d+b)/2),c&&c(e)};if(a){var g=!1,h=!1;a.generatedAssets=a.generatedAssets?a.generatedAssets:{},a.assets&&a.assets.textures&&a.assets.textures.length>0&&(g=!0,a.generatedAssets.images=Lozi.Static.Texture.loadImages(a.assets.textures,e,f,d)),a.assets&&a.assets.sounds&&a.assets.sounds.length>0&&(h=!0,a.generatedAssets.sounds=Lozi.Static.Sound.loadSounds(a.assets.sounds,e,f,d)),0==g&&0==h&&b&&b()}},g=function(a){a.assets&&a.assets.textures&&a.assets.textures.length>0&&(a.generatedAssets.textures=Lozi.Static.Texture.loadTextures(a.assets.textures)),a.assets&&a.assets.meshes&&a.assets.meshes.length>0&&(a.generatedAssets.geometries=Lozi.Static.Geometry.parseGeometries(a.assets.meshes,a.assets.bones)),a.assets&&a.assets.materials&&a.assets.materials.length>0&&(a.generatedAssets.materials=Lozi.Static.Material.generateMaterials(a.assets.materials,a)),a.assets&&a.assets.animations&&(a.generatedAssets.animations=a.generatedAssets.animations?a.generatedAssets.animations:{},a.assets.animations.skin&&a.assets.animations.skin.length>0&&(a.generatedAssets.animations.skin=Lozi.Static.Animation.generateSkinAnimations(a.assets.animations.skin,a)))};f(a,function(){if(g(a),a.createObject=function(b){return Lozi.Static.Object.generateLoziObject(a,b)},a.dispose=function(){Lozi.disposeData(a)},b){var c={};c.data=a,e&&(c.object=Lozi.Static.Object.generateLoziObject(a)),b(c)}},c,d)}},loadFromString:function(a,b,c,d,e){return Lozi.loadFromData(JSON.parse(a),b,c,d,e)},load:function(a,b,c,d,e){var f={totalProgress:0,assetsProgress:0,dataProgress:0},g=function(a){a&&(f.assetsProgress=a),f.totalProgress=f.dataProgress/2+f.assetsProgress/2,c&&c(f)},h=new XMLHttpRequest;h.onload=function(a){4==h.readyState&&200==h.status?Lozi.loadFromString(h.responseText,b,g,d,e):d&&d(h.status)},h.onprogress=function(a){a.lengthComputable&&(f.dataProgress=a.loaded/a.total,g())},h.open("GET",a,!0),h.send(null)},version:function(){return.94}},LoziObject=function(a,b,c){function w(b,c){if(b){var e=c?Lozi.Static.Object.generateObject(b,a.generatedAssets):d;if(e){if(b.id&&(e.loziID=b.id),b.name&&(e.name=b.name),b.meshID&&(e.meshGeometryID=b.meshID),b.animationID&&(e.animationID=b.animationID,n=n.concat(Lozi.Static.Animation.setAnimationData(e,a))),b.lightData&&Lozi.Static.Light.setLightData(e,b.lightData),b.cameraData&&Lozi.Static.Camera.setCameraData(e,b.cameraData),b.transform&&(b.transform.position&&e.position.set(b.transform.position[0],b.transform.position[1],b.transform.position[2]),b.transform.rotation&&(b.cameraData&&(b.transform.rotation[0]=b.transform.rotation[0]-180,e.rotation.order="ZYX"),e.rotation.set(Lozi.Math.radians(b.transform.rotation[0]),Lozi.Math.radians(b.transform.rotation[1]),Lozi.Math.radians(b.transform.rotation[2]))),b.transform.scale&&e.scale.set(b.transform.scale[0],b.transform.scale[1],b.transform.scale[2])),b.scriptProperties&&(e.properties=b.scriptProperties,q.push(e)),b.collider&&(e.collider=b.collider,r.push(e.collider)),b.sound&&(e.sound=b.sound,f.push(e)),e.geometry&&(e.castShadow=e.geometry.castShadow,e.receiveShadow=e.geometry.receiveShadow),b.children&&b.children.length>0)for(var g=0;g<b.children.length;g++)w(b.children[g],e);c&&c.add(e),l.push(e),b.type!=Lozi.Static.Object.types.SpotLight&&b.type!=Lozi.Static.Object.types.DirectionalLight&&b.type!=Lozi.Static.Object.types.PointLight&&b.type!=Lozi.Static.Object.types.AreaLight||o.push(e),b.type!=Lozi.Static.Object.types.OrthographicCamera&&b.type!=Lozi.Static.Object.types.PerspectiveCamera||p.push(e)}}}function x(){b&&w(b,null)}function y(a){if(m.indexOf(a)<0&&m.push(a),a.children)for(var b=0;b<a.children.length;b++)y(a.children[b])}function z(){for(var a=0;a<l.length;a++)if(l[a].geometry&&l[a].geometry.bones&&l[a].skeleton&&l[a].skeleton.bones)for(var b=0;b<l[a].geometry.bones.length;b++)l[a].geometry.bones[b].scriptProperties&&(l[a].skeleton.bones[b].properties=l[a].geometry.bones[b].scriptProperties,q.push(l[a].skeleton.bones[b])),l[a].geometry.bones[b].collider&&(l[a].skeleton.bones[b].collider=l[a].geometry.bones[b].collider,r.push(l[a].skeleton.bones[b].collider)),l[a].geometry.bones[b].sound&&(l[a].skeleton.bones[b].sound=l[a].geometry.bones[b].sound,f.push(l[a].skeleton.bones[b])),l[a].skeleton.bones[b].loziID=l[a].geometry.bones[b].id}function A(){for(var a=0;a<l.length;a++)if(l[a].geometry&&(j.push(l[a]),l[a].morphTargetInfluences&&l[a].morphTargetInfluences.length>0&&l[a].geometry.morphTargets)){for(var b=[],c=0;c<l[a].geometry.morphTargets.length;c++)b.push(l[a].geometry.morphTargets[c].name);k.push({names:b,influences:l[a].morphTargetInfluences})}}function B(){for(var a=0;a<n.length;a++)n[a]&&n[a].update(e)}function C(a){s&&t&&Lozi.Static.Object.onInteract(a,l,s,t)}function D(a){s&&u&&Lozi.Static.Object.onInteract(a,l,s,u)}function E(){x(),y(d),z(),A()}var s,t,u,v,d=this,e=0,f=[],g=[],j=[],k=[],l=[],m=[],n=[],o=[],p=[],q=[],r=[];c&&c.call(d),E(),LoziObject.prototype.update=function(a){e=a,B()},LoziObject.prototype.clone=function(){var a=Lozi.Static.Object.generateLoziObject(this.data());return a.position.x=this.position.x,a.position.y=this.position.y,a.position.z=this.position.z,a.rotation.x=this.rotation.x,a.rotation.y=this.rotation.y,a.rotation.z=this.rotation.z,a.scale.x=this.scale.x,a.scale.y=this.scale.y,a.scale.z=this.scale.z,a},LoziObject.prototype.delete=function(a){a=1==a,this.setOnMouseMove(),this.setOnMouseClick(),s=null,v=null;var b=[];b=Lozi.Utils.getPropertyArray(this.soundSources(),"sound",!0),Lozi.Utils.clearArray(this.soundSources(),null),Lozi.Utils.clearArray(b,Lozi.Static.Sound.disposeSoundSource,1,["remove","children"]),Lozi.Utils.clearArray(this.soundListeners(),Lozi.Static.Sound.disposeSoundListener,1,["remove","children"]),Lozi.Utils.clearArray(this.animations(),Lozi.Static.Animation.disposeAnimation,1),Lozi.Utils.clearArray(this.meshes(),Lozi.Static.Geometry.disposeMesh,1,["remove","children"]),Lozi.Utils.clearArray(this.objects(!0),Lozi.Static.Object.disposeObject,1,["update","delete","data","properties","colliders"]),a&&(b=Lozi.Utils.getPropertyArray(this.properties(),"properties",!0),Lozi.Utils.clearArray(this.properties(),null),Lozi.Utils.clearArray(b,null,3),b=Lozi.Utils.getPropertyArray(this.colliders(),"collider",!0),Lozi.Utils.clearArray(this.colliders(),null),Lozi.Utils.clearArray(b,null,1),Lozi.disposeData(this.data()),this.data=null),b=null},LoziObject.prototype.euler=function(a,b,c){return Lozi.Utils.eulerAngles(d,a,b,c)},LoziObject.prototype.setOnMouseMove=function(a,b){document.removeEventListener("click",C,!1),t=null,a&&b&&(s=Lozi.Static.Object.updateObjectRenderer(a),t=b,document.addEventListener("mousemove",C,!1))},LoziObject.prototype.setOnMouseClick=function(a,b){document.removeEventListener("click",D,!1),u=null,a&&b&&(s=Lozi.Static.Object.updateObjectRenderer(a),u=b,document.addEventListener("click",D,!1))},LoziObject.prototype.activeCamera=function(a){return v||(a=a?a:0,p&&p.length>0&&a<p.length&&(v=p[a])),v},LoziObject.prototype.objects=function(a){return 1==a?m:l},LoziObject.prototype.meshes=function(){return j},LoziObject.prototype.geometries=function(){return a.generatedAssets.geometries},LoziObject.prototype.data=function(){return a},LoziObject.prototype.images=function(){return a.generatedAssets.images},LoziObject.prototype.textures=function(){return a.generatedAssets.textures},LoziObject.prototype.materials=function(){return a.generatedAssets.materials},LoziObject.prototype.lights=function(){return o},LoziObject.prototype.cameras=function(){return p},LoziObject.prototype.animations=function(){return n},LoziObject.prototype.properties=function(){return q},LoziObject.prototype.getProperty=function(a,b,c,d){if(a<q.length)return b?c?1==d?q[a].properties[b][c]:q[a].properties[b][c].value:q[a].properties[b]:q[a].properties},LoziObject.prototype.colliders=function(){return r},LoziObject.prototype.getCollider=function(a){if(a<r.length)return r[a]},LoziObject.prototype.soundSources=function(){return f},LoziObject.prototype.soundListeners=function(){return g},LoziObject.prototype.createSoundListener=function(a){var b=Lozi.Static.Sound.createListener(a);return g.push(b),b},LoziObject.prototype.setSoundListenerVolume=function(a,b){if(g&&a>=0&&a<g.length)return b=b<0?0:b>1?1:b,g[a].setMasterVolume(b),g[a].getMasterVolume()},LoziObject.prototype.setSoundSourceSpeed=function(a,b){if(f&&a>=0&&a<f.length&&f[a].sound&&f[a].sound.source)return b=b<.1?.1:b>10?10:b,f[a].sound.source.playbackRate.value=b,f[a].sound.source.playbackRate.value},LoziObject.prototype.playSoundSource=function(a){f&&a>=0&&a<f.length&&f[a].sound&&f[a].sound.play()},LoziObject.prototype.pauseSoundSource=function(a){f&&a>=0&&a<f.length&&f[a].sound&&f[a].sound.pause()},LoziObject.prototype.stopSoundSource=function(a){f&&a>=0&&a<f.length&&f[a].sound&&f[a].sound.stop()},LoziObject.prototype.setSoundSourceVolume=function(a,b){if(f&&a>=0&&a<f.length&&f[a].sound)return b=b<0?0:b>1?1:b,
f[a].sound.setVolume(b),f[a].sound.getVolume()},LoziObject.prototype.createSoundElement=function(b){if(a.assets.sounds&&a.assets.sounds.length>0)for(var c=0;c<a.assets.sounds.length;c++)if(a.assets.sounds[c].name==b){var d=new Audio;return d.src=a.assets.sounds[c].data,d}return null},LoziObject.prototype.blendShapes=function(){return k},LoziObject.prototype.setBlendShape=function(a,b,c,d){if(d=d?d:0,k&&a>=0&&a<k.length&&(c>=0||c<=1)){var f=k[a];if(f){for(var g=-1,h=0;h<f.names.length;h++)if(f.names[h]==b){g=h;break}if(g>=0&&f.influences[g]!=c)if(0==d)f.influences[g]=c;else{var i=Math.abs(f.influences[g]-c),j=function(){var a=f.influences[g],b=d*(i*e)/d;a!=c&&(a=a<c?Math.min(a+=b,c):Math.max(a-=b,c),f.influences[g]=a,a==c&&clearInterval(interval))};interval=setInterval(j,1e3*d*e)}}}},LoziObject.prototype.playAnimation=function(a,b,c,e){var f="";if(e=0!=e||e,c=c?c:0,n&&a>=0&&a<n.length){var g=n[a].clips[n[a].currentClip],h=n[a].clips[b];if(b==n[a].currentClip&&"Once"!=h.mode)return;g&&(g.play(),g.enabled=!0,g.clampWhenFinished=!0,g.setLoop(Lozi.Static.Animation.loopMode(g.mode)),n[a].currentClip=g.name,f=f?f:g.name),h&&(h.enabled=!0,h.reset(),h.play(),h.setLoop(Lozi.Static.Animation.loopMode(h.mode)),h.clampWhenFinished=!0,"Once"==h.mode&&1==e&&f!=h.name&&f&&setTimeout(function(){d.playAnimation(a,f,c)},1e3*h.duration),g&&g.crossFadeTo(h,c),n[a].currentClip=h.name)}},LoziObject.prototype.stopAnimation=function(a){if(n)if(a&&a>=0&&a<n.length){if(n[a].clips){n[a].currentClip="";for(var b in n[a].clips)n[a].clips[b].stop()}}else for(var c=0;c<n.length;c++)if(n[c].clips){n[c].currentClip="";for(var b in n[c].clips)n[c].clips[b].stop()}}};